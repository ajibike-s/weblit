<section>
  <!-- Skeleton Loader -->
  <section *ngIf="loading" class="loading-wrapper">
    <article class="skeleton-item" *ngFor="let i of [1,2,3,4]">
      <nz-skeleton [nzLoading]="loading" [nzActive]="true" [nzParagraph]="{ rows: 4 }"></nz-skeleton>
    </article>
  </section>
  <div class="results-container">
  <aside>
    <div class="header"><h5>{{research?.title}}</h5></div>
    <div class="query-container">
      <div class="queries" *ngFor="let filterQuery of filterQueries">
        <div class="query">
          <strong>Search String</strong>
          <p>{{ filterQuery.searchString }}</p>
          <strong>Research Question</strong>
          <p>{{ filterQuery.researchQuestion }}</p>
          <strong>Inclusion Criteria</strong>
          <p>{{ filterQuery.inclusionCriteria }}</p>
          <strong>Exclusion Criteria</strong>
          <p>{{ filterQuery.exclusionCriteria }}</p>
          <span
            ><strong>Total Research paper: </strong>
            {{ filterQuery.totalFound }}</span
          >
          <div class="button-wrapper">
            <button
              class="btn btn-danger"
              (click)="deleteQuery(filterQuery._id)"
            >
              <span nz-icon nzType="delete" nzTheme="fill"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </aside>
  <!-- Research Papers -->
    <div class="primary-studies" *ngIf="!loading">
      <div class="documents-wrapper">
        <div class="empty-container" *ngIf="primaryStudies.length === 0">
          <app-empty [createQuery]="showCreateQueryModal.bind(this)"></app-empty>
        </div>

        <article class="document" *ngFor="let primaryStudy of primaryStudies; let i = index">
          <div class="document-header">
            <!-- Title is now always an <a> tag with a class -->
            <a class="document-title" [href]="primaryStudy.url || '#'">
              {{ primaryStudy.title ?? "No title available" }}
            </a>
          </div>

          <!-- Truncated Abstract -->
          <p class="abstract">
            {{ truncateText(primaryStudy.abstract, i) }}
            <span class="read-more" *ngIf="primaryStudy.abstract?.split(' ').length > 20" (click)="toggleAbstract(i)">
              {{ expandedAbstracts[i] ? "Show Less" : "Read More" }}
            </span>
          </p>

          <p class="authors">
            <span *ngFor="let author of primaryStudy.authors">{{ author.name ?? "Author not found" }}, </span>
          </p>

          <!-- Metadata -->
          <div class="meta-data">
            <span>cited by {{ primaryStudy.citationCount ?? 0 }}</span>
            <span>referenced {{ primaryStudy.referenceCount ?? 0 }} times</span>
            <span>{{ primaryStudy.year ?? "N/A" }}</span>

            <!-- Open Access (Download PDF) - Removed "Not Available" message -->
            <span *ngIf="primaryStudy.openAccessPdf?.url">
              <a  class="download" [href]="primaryStudy.openAccessPdf.url"><span nz-icon nzType="download" nzTheme="outline"></span></a>
            </span>
          </div>
        </article>
      </div>
    </div>
  </div>
</section>
